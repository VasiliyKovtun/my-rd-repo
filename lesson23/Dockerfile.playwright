FROM mcr.microsoft.com/playwright:v1.57.0-jammy

WORKDIR /tests

# ðŸ”¹ Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Java (Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð´Ð»Ñ Allure CLI)
RUN apt-get update && \
    apt-get install -y openjdk-17-jre && \
    rm -rf /var/lib/apt/lists/*

# ðŸ”¹ Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ JAVA_HOME
ENV JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
ENV PATH=$JAVA_HOME/bin:$PATH

# ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ package.json
COPY package.json package-lock.json* ./
RUN npm install

# ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ Ñ‚ÐµÑÑ‚Ñ‹
COPY . .

CMD sh -c "\
  echo 'Waiting for app...'; \
  until curl -s http://lesson23-app > /dev/null; do sleep 2; done; \
  echo 'App is up'; \
  npm run test:allure \
"
